var pageedit;function sendMessage(){console.log("sending message to injected script");var e=pageedit.editor.getData();CKEDITOR.remove(pageedit.editor),delete CKEDITOR,delete pageedit.editor,document.open(),document.write(e),document.write("<input id='save_page_hidden_trigger'/>"),document.close(),window.postMessage({type:"SAVE_PAGE"},"*")}!function(){window.webkitURL||window.URL;var e="pageedit",t="__CKEditor_textArea__";function d(e){var d,o,n,i,c=document.title;if(e.toggleEditor)if(pageedit&&pageedit.editor){var r=pageedit.editor.getData();CKEDITOR.remove(pageedit.editor),delete CKEDITOR,delete pageedit.editor,document.open(),document.write(r),document.close()}else{for(i=document.doctype,o=(i?(n="<!DOCTYPE "+i.nodeName,i.publicId?(n+=' PUBLIC "'+i.publicId+'"',i.systemId&&(n+=' "'+i.systemId+'"')):i.systemId&&(n+=' SYSTEM "'+i.systemId+'"'),i.internalSubset&&(n+=" ["+i.internalSubset+"]"),n+">\n"):"")+document.documentElement.outerHTML,document.open(),document.addEventListener("load",function d(){var n,i;document.removeEventListener("load",d,!0),n=document.createElement("form"),(i=document.createElement("textarea")).style.display="none",i.setAttribute("id",t),n.appendChild(i),document.body.appendChild(n),CKEDITOR.config.toolbar=e.options.toolbar,(pageedit={editor:CKEDITOR.replace(t,{customConfig:e.configScript})}).editor.setData(o,function(){pageedit.editor.addCommand("save",{exec:function(e){sendMessage()}})})},!0),document.writeln("<!DOCTYPE html>"),document.write("<html>"),document.write("<head>"),document.write("<title>"),document.write(c),document.write("</title>"),document.write("</head>"),document.write("<body>"),d=0;d<e.scripts.length;d++)document.write("<script type='text/javascript' src='"+e.extensionURI+e.scripts[d]+"?"+(""+Math.random()).split(".")[1]+"'><\/script>");document.write("</body>"),document.write("</html>"),document.close()}}document.head.removeChild(document.head.childNodes[document.head.childNodes.length-1]),addEventListener("message",function(t){console.log("listening message on injected script",t);var o=t.data;0==o.indexOf(e+"::")&&d(JSON.parse(o.substr(e.length+2)))},!1)}();